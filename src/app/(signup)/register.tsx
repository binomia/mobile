import React, { useContext, useRef, useState } from 'react';
import { VStack } from 'native-base';
import PagerView from 'react-native-pager-view';
import colors from '@/src/colors';
import CreateAccount from '@/src/components/signup/register/CreateAccount';
import Address from '@/src/components/signup/register/Address';
import VerifyCode from '@/src/components/signup/register/VerifyCode';
import ScanFrontID from '@/src/components/signup/register/ScanFrontID';
import ScanBackID from '@/src/components/signup/register/ScanBackID';
import AccountCreated from '@/src/components/signup/register/AccountCreated';
import FaceID from '@/src/components/signup/register/FaceID';
import { GlobalContextType } from '@/src/types';
import { GlobalContext } from '@/src/contexts/globalContext';
import IDData from '@/src/components/signup/register/IdData';
import { SafeAreaView } from 'react-native-safe-area-context';


const RegisterComponent: React.FC = (): React.JSX.Element => {
    const ref = useRef<PagerView>(null);
    const [currentPage, setCurrentPage] = useState<number>(0);
    const { setShowCloseButton } = useContext<GlobalContextType>(GlobalContext);


    const nextPage = () => {
        ref.current?.setPage(currentPage + 1)

        if (currentPage === 5) {
            setShowCloseButton(false)
        }

        setCurrentPage(currentPage + 1)
    }

    function reRenderPage<T>(state?: T) {
        ref.current?.render()
        return state
    }

    const prevPage = () => {
        if (currentPage === 0) {
            ref.current?.setPage(1)
            setCurrentPage(1)
        } else
            ref.current?.setPage(currentPage - 1)
        setCurrentPage(currentPage - 1)
    }


    return (
        <SafeAreaView style={{ backgroundColor: colors.darkGray, flex: 1 }}>
            <VStack flex={1}>
                <PagerView scrollEnabled={false} ref={ref} style={{ flex: 1 }} initialPage={currentPage}>
                    <CreateAccount key={"0"} nextPage={nextPage} />
                    <Address key={"1"} nextPage={nextPage} prevPage={prevPage} />
                    <IDData key={"2"} nextPage={nextPage} prevPage={prevPage} />
                    <ScanFrontID key={"3"} nextPage={nextPage} prevPage={prevPage} />
                    <ScanBackID key={"4"} nextPage={nextPage} prevPage={prevPage} />
                    <FaceID key={"5"} nextPage={nextPage} prevPage={prevPage} reRenderPage={reRenderPage} />
                    <VerifyCode key={"6"} nextPage={nextPage} prevPage={prevPage} />
                    <AccountCreated key={"7"} />
                </PagerView>
            </VStack>
        </SafeAreaView>
    );
}


export default RegisterComponent
